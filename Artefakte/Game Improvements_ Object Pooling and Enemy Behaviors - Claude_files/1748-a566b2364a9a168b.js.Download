"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1748],{32559:function(e,t,n){n.d(t,{GO:function(){return k},Gm:function(){return T},Kn:function(){return M},L8:function(){return j},O3:function(){return g},Qs:function(){return w},RN:function(){return _},Yc:function(){return b},bQ:function(){return v},cd:function(){return i},dY:function(){return C},iR:function(){return S},nL:function(){return o},u0:function(){return x}});var a,i,o,s=n(96933),r=n(5362),l=n(27218),u=n(30947),c=n(13262),d=n(77930),p=n(21520),h=n.n(p),m=n(7653),f=n(74119);(i||(i={})).Student="student",(a=o||(o={})).Study="study",a.Career="career",a.Research="research";let g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{defer:t}=e,{activeOrganization:n}=(0,l.t)(),a=(0,f.U)(),i=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(i,"/projects?include_harmony_projects=true"),{queryKey:[c.gi,{orgUuid:i}],enabled:!!(n&&a&&!t),staleTime:0,select:e=>e.filter(e=>!e.archived_at)})},_=()=>{let{activeOrganization:e}=(0,l.t)(),t=(0,r.OJ)();return(0,m.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},v=()=>{let{data:e,isLoading:t}=g();return{data:null==e?void 0:e.filter(e=>e.is_starred),isLoading:t}},y=(e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),a=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...a]},k=()=>{let e=_(),t=(0,s.Pe)();return(0,m.useCallback)(async()=>{let[n,a]=await Promise.all([e(),t({limit:void 0})]);return y(n,a)},[t,e])},x=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{defer:t}=e,n=(0,f.U)(),{data:a,isLoading:i}=(0,s.QR)({limit:void 0,defer:!n||t}),{data:o,isLoading:r}=g({defer:t});return(0,m.useMemo)(()=>i||r?{data:o,isLoading:!0}:o&&a?{data:y(o,a),isLoading:!1}:{data:o,isLoading:!1},[o,a,i,r])},b=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid;return(0,r.WE)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[c.$T,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof u.Hx&&404===e.statusCode}})},w=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[c.gi,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.n$,{orgUuid:t}]})}})},C=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid,a=T();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{a(e)},queryKey:[c.$T,{orgUuid:n,projectUuid:e}]})},j=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid,a=T();return(0,r.uC)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"DELETE",{onSuccess:()=>{a(e)}})},S=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid;return(0,r.WE)("/api/organizations/".concat(n,"/projects/").concat(e,"/conversations"),{queryKey:[c.lx,{orgUuid:n,projectUuid:e}],enabled:!!t,staleTime:0,select:e=>h()(e,e=>new Date(e.updated_at)).reverse()})},M=()=>{var e,t;let n=g(),a=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:a}},T=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[c.$T,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[c.gi,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.n$,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.lx,{orgUuid:t,projectUuid:e}]})}}},26525:function(e,t,n){n.d(t,{Ch:function(){return E},H0:function(){return F},Qe:function(){return S},Qt:function(){return z},Vn:function(){return Z},kR:function(){return I},kS:function(){return L},sE:function(){return D}});var a=n(56683),i=n(27573),o=n(5161),s=n(28266),r=n(76220),l=n(3053),u=n(5362),c=n(27218),d=n(27895),p=n(9788),h=n(32737),m=n(30947),f=n(6385),g=n(14448),_=n(35807),v=n(42755),y=n(45144),k=n(7653),x=n(45790),b=n(40950),w=n(41496),C=n(1804);function j(){let e=(0,a._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-styrene\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return j=function(){return e},e}let S=20,M=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},T=e=>e.replace(/\0/g,""),E=e=>{e.extracted_content=T(e.extracted_content),e.file_name=T(e.file_name),e.file_type=T(e.file_type)},O=(e,t)=>({file_name:M(e),file_type:e.type,file_size:e.size,extracted_content:t});function L(e){let{syncSourceCount:t,files:n,setFiles:a,numExistingConversationFiles:l,attachments:u,setAttachments:c,numExistingConversationAttachments:p,detectSameAttachment:m,selectedModel:f,blobFileUploadsEnabled:g}=e,{addError:y}=(0,d.e)(),w=(0,s.wN)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:s,numExistingConversationAttachments:l,numExistingConversationFiles:u,selectedModel:c,blobFileUploadsEnabled:d}=e,p=(0,b.Z)(),{modelConfig:m}=(0,r.V)(c),f=m.image_in,[g,y,w,C]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:s,numExistingConversationFiles:l,selectedModel:u,blobFileUploadsEnabled:c}=e,{modelConfig:d}=(0,r.V)(u),p=d.image_in,h=F()&&d.pdf_in,{isUploading:m,setIsUploading:f,handleError:g,handleUpload:_}=Z({imagesEnabled:p,blobFileUploadsEnabled:c,onUploadComplete:n,rasterizePdfUploadsEnabled:h}),v=(0,k.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:r=0,showError:u=!0}=e,{attachmentUploads:d,imageUploads:m,rasterizedDocumentUploads:f,outOfContextFileUploads:_}=(0,o.Jw)(n,{imagesEnabled:p,blobFileUploadsEnabled:c,rasterizePdfUploadsEnabled:h});return r+d.length+m.length+f.length+_.length+a.length+s.length+t>S?(u&&g((0,i.jsx)(x.Z,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:S}})),!1):!(m.length+f.length+s.length+l>100)||(u&&g((0,i.jsx)(x.Z,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:100,suggestion:l<100?(0,i.jsx)(x.Z,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,i.jsx)(x.Z,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}})),!1)},[p,c,a,s,t,l,g,h]);return[m,f,v,(0,k.useCallback)(async e=>{v({newUploads:e})&&await _(e)},[_,v])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:s,existingAttachments:a,numExistingConversationFiles:u,numExistingConversationAttachments:l,selectedModel:c,blobFileUploadsEnabled:d}),j=function(e){let{handleUpload:t}=e,n=(0,k.useRef)({ready:0,total:0}),a=(0,k.useCallback)(()=>{n.current={ready:0,total:0}},[]),i=(0,k.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),o=(0,k.useCallback)((e,t)=>{let a=e.length;for(let s=0;s<a;s++){let a=e[s];a.isFile?(n.current.total+=1,a.file(e=>{t.push(e),i(t)})):a.isDirectory&&a.createReader().readEntries(e=>{o(e,t)})}},[i]);return(0,k.useCallback)(e=>{var t;e.preventDefault(),a();let n=null===(t=e.dataTransfer)||void 0===t?void 0:t.items;if(!n)return;let i=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&i.push(t)}o(i,[])},[o,a])}({handleUpload:C}),M=(0,k.useCallback)(async e=>{await C(Array.from(e))},[C]),T=(0,k.useCallback)(async e=>{let t=e.target.files;t&&await C(Array.from(t)),e.target.value=""},[C]),E=f?(0,i.jsx)(x.Z,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, 30mb each)",id:"ialBpH0eLp",values:{maxUploads:S}}):(0,i.jsx)(x.Z,{defaultMessage:"Add content ({maxUploads} max, 30mb each)\\nAccepts pdf, txt, csv, etc.",id:"70asB5brJP",values:{maxUploads:S}}),O=(0,k.useCallback)(e=>{T(e)},[T]),L=(0,k.useMemo)(()=>({type:"file",accept:(0,o.tB)({imagesEnabled:f,outOfContextFilesEnabled:d}).join(","),onChange:O,multiple:!0,"aria-label":p.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[d,f,O,p]);return[g,y,w,j,M,C,(0,i.jsx)(h.u,{className:"text-center",tooltipContent:E,children:(0,i.jsxs)(R,{children:[(0,i.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...L}),g?(0,i.jsx)(_.U,{className:"animate-spin",size:18}):(0,i.jsx)(v.p,{size:18,weight:"light"})]})},"upload-tooltip"),L]}({syncSourceCount:t,onUploadComplete:(0,k.useCallback)(async(e,t)=>{m&&e.find(e=>m(e.extracted_content))&&y((0,i.jsx)(x.Z,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"})),c(t=>[...t,...e]),a(e=>[...e,...t])},[c,m,y,a]),existingAttachments:u,existingFiles:n,numExistingConversationAttachments:p,numExistingConversationFiles:l,selectedModel:null!=f?f:w,blobFileUploadsEnabled:g})}let P=async(e,t,n)=>{let a=new Image;if(a.src=URL.createObjectURL(e),await new Promise(e=>{a.onload=e,setTimeout(e,250)}),!a.width||!a.height||"image/png"!==e.type&&a.width<=t&&a.height<=n)return e;let i=a.width/a.height,o=a.width,s=a.height;a.width>t&&(s=(o=t)/i),s>n&&(o=(s=n)*i);let r=document.createElement("canvas");r.style.display="none",document.body.appendChild(r);let l=r.getContext("2d");if(!l||!l.imageSmoothingQuality)return document.body.removeChild(r),e;l.imageSmoothingQuality="high",r.width=o,r.height=s,l.drawImage(a,0,0,o,s);let u=await new Promise(e=>{r.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(r),u)?new File([u],e.name,{type:"image/webp"}):e},D=()=>{let{value:e}=(0,g.F)("use_canvas_resize");return(0,k.useCallback)(async t=>e?await P(t,2e3,2e3):t,[e])},z=()=>{let e=U(),t=I();return async(n,a,i)=>{try{return await t(n,a,i)}catch(t){e(t,(0,o.Wr)(n)?"image":"file")}}},N=e=>{let t=U(),n=I(),a=(0,u.OJ)();return async(i,o,s)=>{let r={};try{r.file=await n(i,o,s)}catch(n){n instanceof m.Hx&&"document_too_many_pages"===n.errorCode?r.attachment=await Q(a,i,o,e):t(n,"document")}return r}},I=()=>{let e=(0,u.OJ)();return async(t,n,a)=>{let i=new FormData;i.append("file",t);let o=a?"/api/organizations/".concat(n,"/projects/").concat(a,"/upload"):"/api/".concat(n,"/upload"),s=await e(o,{method:"POST",body:i}),r=await s.json();if(s.ok)return r;throw(0,m.fT)(s.status,r,"File upload failed",s.headers)}},B=async(e,t,n,a)=>{let o;let s=new FormData;s.append("file",t);try{o=await e("/api/organizations/".concat(n,"/convert_document"),{method:"POST",body:s})}catch(e){return(0,y.Tb)(e),a((0,i.jsx)(x.Z,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"}))}if(429===o.status)return a((0,i.jsx)(x.Z,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"}));if(413===o.status)return a((0,i.jsx)(x.Z,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"}));if(!o.ok)return a((0,i.jsx)(x.Z,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}));let r=await o.json();return r&&0!==Object.keys(r).length&&r.extracted_content?(r.file_name=M(t),r):a((0,i.jsx)(x.Z,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}))},Z=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:s,onUploadComplete:r,onError:p,projectUuid:h}=e,{activeOrganization:m}=(0,c.t)(),g=null!==(t=null==m?void 0:m.uuid)&&void 0!==t?t:"",[_,v]=(0,k.useState)(!1),{addError:y}=(0,d.e)(),b=(0,k.useCallback)(e=>{v(!1),y(e),p&&p()},[y,p,v]),C=D(),j=z(),S=N(b),M=(0,u.OJ)(),T=(0,l.z$)(),E=(0,k.useCallback)(async(e,t)=>{let{attachmentUploads:l,imageUploads:u,rasterizedDocumentUploads:c,unsupportedUploads:d,tooLargeUploads:p,outOfContextFileUploads:m}=(0,o.Jw)(e,{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:s}),_=d.map(e=>(0,o.mD)(e.name));if(_.length>0)return b((0,i.jsx)(x.Z,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:_.length,formats:(0,i.jsx)(w.yX,{type:"conjunction",value:[...new Set(_)]})}}));if(p.length>0)return T.track({event_key:"file_upload_too_large",large_files:p.map(e=>({file_type:e.type,file_size:e.size}))}),b((0,i.jsx)(x.Z,{defaultMessage:"You may not upload files larger than 30mb.",id:"Gr/GvEZTX1"}));v(!0);let y=[],k=0,E=(e,n)=>{if(void 0===t)return!0;let a=new Blob([n]).size/f.r6;return!((k+=a)>t)||(b((0,i.jsx)(x.Z,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:e}})),!1)};for(let e of l){let t=await Q(M,e,g,b);if(!(t&&E(e.name,t.extracted_content)))return;await r([t],[])}for(let e of u){let t=await C(e),n=await j(t,g,h);n&&y.push(n)}for(let e of c){let{file:t,attachment:n}=await S(e,g,h);if(t&&y.push(t),n){if(!E(e.name,n.extracted_content))return;await r([n],[])}}for(let e of m){let t=await j(e,g,h);t&&y.push(t)}await r([],y),v(!1)},[a,M,r,n,b,j,S,g,C,T,s,h]);return{isUploading:_,setIsUploading:v,handleError:b,handleUpload:E}},R=p.q.label(j()),Q=async(e,t,n,a)=>{if(!(0,o.dF)(t))try{let e=await (0,o.CL)(t);return O(t,e)}catch(e){}let i=await B(e,t,n,a);if(i)return E(i),i},U=()=>{let{addError:e}=(0,d.e)();return(0,k.useCallback)((t,n)=>{if(t instanceof m.Hx){if("rate_limit_error"===t.type){e((0,i.jsxs)("p",{children:[(0,i.jsx)(x.Z,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:n}}),(0,i.jsx)(C.o,{})]}));return}if("document_password_protected"===t.errorCode){e((0,i.jsx)("p",{children:(0,i.jsx)(x.Z,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}));return}}if(t instanceof m.Hx&&"Image is too large"===t.message){e((0,i.jsx)("p",{children:(0,i.jsx)(x.Z,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,i.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}));return}e((0,i.jsx)("p",{children:(0,i.jsx)(x.Z,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:n}})}))},[e])},F=()=>{let{value:e}=(0,g.F)("janus_claude-ai");return e}},1804:function(e,t,n){n.d(t,{o:function(){return u}});var a=n(27573),i=n(8571),o=n(27218),s=n(88146),r=n(45790);let l=()=>{let e=(0,i.Z)(),{websiteBaseUrl:t}=(0,i.m)();return e?(0,a.jsx)(r.Z,{defaultMessage:"Or consider <link>upgrading to Claude Pro</link>.",id:"j0jOXOpUyS",values:{link:e=>(0,a.jsx)("a",{href:"/upgrade/pro",className:"font-bold underline",rel:"noreferrer",children:e})}}):(0,a.jsx)(r.Z,{defaultMessage:"Or <link>contact sales</link> if you would be interested in upgrading to a paid version of Claude.",id:"3hk4yMCf5v",values:{link:e=>(0,a.jsx)(s.default,{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:e})}})};function u(){let e=(0,o.w7)(),t=(0,o.uh)();return e&&!t?(0,a.jsx)(l,{}):null}},5161:function(e,t,n){n.d(t,{CL:function(){return E},Jw:function(){return S},MR:function(){return _},Wr:function(){return w},dF:function(){return M},eh:function(){return O},mD:function(){return x},tB:function(){return v},wI:function(){return c}});var a=n(27218),i=n(1812),o=n(14448),s=n(18916);let r=[".DS_Store"],l=["jpg","jpeg","png","gif","webp"],u=["image/jpeg","image/png","image/gif","image/webp"],c={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip"],p=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],h=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],m=["docx","rtf","epub","odt","odp","pdf"],f=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],g=["csv"],_=3e7,v=e=>{let{imagesEnabled:t=!1,outOfContextFilesEnabled:n=!1}=e;return[".pdf",".doc",".docx",".rtf",".epub",".odt",".odp",".pptx",...k(),...t?y():[],...n?p.map(e=>".".concat(e)):[]]},y=()=>l.map(e=>".".concat(e)),k=()=>h.map(e=>".".concat(e)),x=e=>e.split(".").pop().toLowerCase(),b=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:a=!1}=t,i=x(e.name);return!!(!n&&(l.includes(i)||u.includes(e.type)))||(a?d.includes(i):[...d,...p].includes(i))},w=e=>{let t=x(e.name);return l.includes(t)||u.includes(e.type)},C=e=>[...g,...p].includes(x(e.name)),j=e=>!!r.includes(e.name),S=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:a=!1,rasterizePdfUploadsEnabled:i}=t,o=[],s=[],r=[],l=[],u=[],c=[];return e.filter(e=>!j(e)).forEach(e=>{let t=n&&w(e);b(e,{imagesEnabled:n,blobFileUploadsEnabled:a})?u.push(e):e.size>_?c.push(e):a&&C(e)?r.push(e):i&&("pdf"===x(e.name)||"application/pdf"===e.type)?l.push(e):M(e)?o.push(e):t?s.push(e):o.push(e)}),{attachmentUploads:o,imageUploads:s,rasterizedDocumentUploads:l,unsupportedUploads:u,tooLargeUploads:c,outOfContextFileUploads:r}},M=e=>{let t=x(e.name);return m.includes(t)||f.includes(e.type)},T=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,a=Math.min(t.length-1,1e3);for(let e=0;e<a;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let i=!0,o=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127){if(o=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){i=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){i=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){i=!1;break}e+=3}else{i=!1;break}}}if(i&&o)return"utf-8";let s=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let a=e[n];a<32?t.control++:a<127?t.ascii++:a>127&&(t.nonAscii++,(a>=192&&a<=255||a>=168&&a<=183)&&t.cyrillic++,(a>=128&&a<=159||a>=160&&a<=255)&&t.latin1++)}return t})(t),r=s.cyrillic/s.total*100,l=s.latin1/s.total*100,u=s.ascii/s.total*100;if(s.nonAscii>0){if(r>.3)return"windows-1251";if(l>s.control/s.total*100)return"windows-1252"}return u>90&&s.control/s.total<.1?"ascii":"utf-8"},E=async e=>{let t=await e.arrayBuffer(),n=T(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function O(){var e;let{value:t}=(0,o.F)("ooc_attachments"),{account:n}=(0,a.t)(),r=(0,i.T)(),l=null!==(e=null!=r?r:null==n?void 0:n.settings)&&void 0!==e?e:{},{value:u}=(0,s.h)(l);return!!t&&u}},28266:function(e,t,n){n.d(t,{hH:function(){return q},wN:function(){return V},Qk:function(){return ee},pV:function(){return Y},lE:function(){return K}});var a,i,o,s,r=n(27573),l=n(96933),u=n(1804),c=n(3053),d=n(8571),p=n(27218),h=n(27895),m=n(66092),f=n(30947),g=n(6385),_=n(66894),v=n(14448),y=n(13262),k=n(91598),x=n(51432),b=n(45144),w=n(77930),C=n(5068),j=n(13784),S=n(88146),M=n(81695),T=n(7653),E=n(45790),O=n(15992),L=n(8073);let P=1e3/60;class D{_getCurrentTextBlockCharCount(){let e=this.completionsToSmooth[this.completionsToSmooth.length-1];return"text"===e.type?[...e.text].length:0}_getBlockCharCount(e){var t,n,a;return"text"===e.type?e.text.length:"thinking"===e.type?e.thinking.length:"redacted_thinking"===e.type?e.data.length:"tool_use"===e.type?(null===(t=e.partial_json)||void 0===t?void 0:t.length)||0:"tool_result"===e.type?0:"bell"===e.type?((null===(n=e.text)||void 0===n?void 0:n.length)||0)+((null===(a=e.title)||void 0===a?void 0:a.length)||0):0}_maybeConvertMessageEventToContentBlock(e){let t=this.completionsToSmooth[this.completionsToSmooth.length-1];switch(e.type){case"content_block_delta":if("text_delta"===e.delta.type)return{type:"text",text:e.delta.text,citations:[]};if("input_json_delta"===e.delta.type){if(t&&"tool_use"===t.type)return{type:"tool_use",id:"",name:"",partial_json:e.delta.partial_json};if(t&&"tool_result"===t.type)return{type:"tool_result",tool_use_id:"",name:"",is_error:!1,content:[{type:"text",text:e.delta.partial_json}]}}if("citation_start_delta"===e.delta.type){this.pendingCitations[e.delta.citation.uuid]={...e.delta.citation,start_index:this._getCurrentTextBlockCharCount()};return}if("citation_end_delta"===e.delta.type)return{type:"text",text:"",citations:[{...this.pendingCitations[e.delta.citation_uuid],end_index:this._getCurrentTextBlockCharCount()}]};if("thinking_cut_off_delta"===e.delta.type)return{type:"thinking",thinking:"",start_timestamp:"",cut_off:e.delta.cut_off};if("thinking_delta"===e.delta.type)return{type:"thinking",thinking:e.delta.thinking,start_timestamp:e.delta.start_timestamp,stop_timestamp:e.delta.stop_timestamp};if("signature_delta"===e.delta.type)return{type:"thinking",thinking:"",signature:e.delta.signature,start_timestamp:""};break;case"content_block_start":return"thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block;case"content_block_stop":if((null==t?void 0:t.type)==="thinking")return{type:"thinking",thinking:"",start_timestamp:t.start_timestamp||"",stop_timestamp:e.stop_timestamp,signature:t.signature,cut_off:t.cut_off};if((null==t?void 0:t.type)==="redacted_thinking")return{type:"redacted_thinking",data:"",start_timestamp:t.start_timestamp||"",stop_timestamp:e.stop_timestamp}}}_set_raw_completion(e){if(0===this.start&&(this.start=Date.now()),"content_block_delta"===e.type&&"thinking_summary_delta"===e.delta.type){let t=this.completionsToSmooth.findLast(e=>"thinking"===e.type);t&&(t.summaries=[...t.summaries||[],e.delta.summary])}else{let t=this._maybeConvertMessageEventToContentBlock(e);t&&(e=>{if(0===this.completionsToSmooth.length){this.completionsToSmooth.push(e);return}let t=this.completionsToSmooth[this.completionsToSmooth.length-1];if(t.type!==e.type||"tool_use"===e.type&&e.id||"tool_result"===e.type&&e.tool_use_id){this.completionsToSmooth.push(e);return}switch(e.type){case"text":this.is_inside_paprika=!1,t.type===e.type&&(t.text+=e.text,(t.citations||e.citations)&&(t.citations=(t.citations||[]).concat(e.citations||[])));break;case"thinking":if(this.is_inside_paprika=!0,"thinking"===t.type){t.thinking+=e.thinking,t.cut_off=e.cut_off;let n=e.signature||"";t.signature=(t.signature||"")+n,e.stop_timestamp&&(t.stop_timestamp=e.stop_timestamp)}break;case"redacted_thinking":this.is_inside_paprika=!0,"redacted_thinking"===t.type&&(t.data+=e.data,e.stop_timestamp&&(t.stop_timestamp=e.stop_timestamp));break;case"tool_use":if(this.is_inside_paprika=!1,"tool_use"===t.type){var n,a;t.partial_json=(null!==(n=t.partial_json)&&void 0!==n?n:"")+(null!==(a=e.partial_json)&&void 0!==a?a:"")}break;case"tool_result":this.is_inside_paprika=!1,"tool_result"===t.type&&(t.content=e.content);break;case"bell":this.is_inside_paprika=!1,"bell"===t.type&&(t.text+=e.text||"",t.title+=e.title||"");break;default:this.is_inside_paprika=!1}})(t)}this.model_done="message_stop"===e.type;let t=this.completionsToSmooth.reduce((e,t)=>e+this._getBlockCharCount(t),0);if(this.totalCompletionLength=t,this.arrivals.push([(Date.now()-this.start)/1e3,t]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.completionsToSmooth),t=e[e.length-1];t&&"tool_result"===t.type&&0===t.content.length||this.on_completion(e)}}_get_smoothed_completion(){if(0===this.start)return[];let e=(Date.now()-this.start)/1e3,t=this.arrivals[this.arrivals.length-1][1]+(this.model_done?100:0),n=.9*e-(this.is_inside_paprika?3:.3),a=this.arrivals.filter(e=>e[0]<n).map(e=>e[1]),i=a[a.length-1],o=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let i=e(t),o=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(i>a)throw Error("Lower f is greater than zero");if(o<-a)throw Error("Upper f is less than zero");for(;i<-a;){let a=(t+n)/2,s=e(a);s<=0?(t=a,i=s):(n=a,o=s)}return t}(n=>{let a=(n-this.x)/(e-this.t),o=1/(e-this.t);return 2*this.gamma*o*(a-this.v)-1/(n-i)+1/(t-n)},i,t),s=(o-this.x)/(e-this.t);this.v=this.alpha*this.v+(1-this.alpha)*s,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(o,this.x),this.t=e,this.smoother_done=this.model_done&&this.x>=this.totalCompletionLength,this.stats.push({t:e,x:o,v:s,min_chars:i,max_chars:t});let r=(e,t)=>{var n,a;return"tool_result"===e.type?e:"text"===e.type?{...e,text:e.text.slice(0,t)}:"tool_use"===e.type?{...e,partial_json:null===(n=e.partial_json)||void 0===n?void 0:n.slice(0,t)}:"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:"redacted_thinking"===e.type?{...e,data:e.data.slice(0,t)}:"bell"===e.type?{...e,text:(null===(a=e.text)||void 0===a?void 0:a.slice(0,t))||""}:e},l=0,u=[];for(let e of this.completionsToSmooth){let t=this._getBlockCharCount(e);if(l+t<this.x)u.push(e),l+=t;else{let t=r(e,this.x-l);u.push(t);break}}return u}getTextCompletion(){let e=this.completionsToSmooth.find(e=>"text"===e.type);return e&&e.text||""}onMessage(e){this._set_raw_completion(e)}async task(e,t){for(;!this.smoother_done&&!t.aborted;){if(this.completionsToSmooth.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}await new Promise(e=>setTimeout(e,P))}}constructor(e){var t;this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.completionsToSmooth=[],this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.pendingCitations={},this.dont_smooth=!1,this.model_done=!1,this.smoother_done=!1,this.is_inside_paprika=!1,this.stats=[],this.redactedStrings=null!==(t=null==e?void 0:e.redactedStrings)&&void 0!==t?t:{}}}var z=n(58884);let N=(e,t)=>t.reduce((t,n)=>t+e.blockSize(n),0),I=(e,t,n)=>{let{blockSize:a,sliceBlock:i}=e,o=[];if(n<=0)return[];let s=0;for(let e of t){if(s+a(e)>=n){o.push(i(e,n-s));break}o.push(e),s+=a(e)}return o},B=1e3/60;class Z{_get_smoothed_completion(){var e,t,n;if(0===this.start)return[];let a=(Date.now()-this.start)/1e3,i=this.arrivals[this.arrivals.length-1][1]+(this.model_done?100:0),o=.9*a-(null!==(n=null===(e=(t=this.blockOperations).getBlockDeadlineOffset)||void 0===e?void 0:e.call(t))&&void 0!==n?n:.3),s=this.arrivals.filter(e=>e[0]<o).map(e=>e[1]),r=s[s.length-1],l=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let i=e(t),o=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(i>a)throw Error("Lower f is greater than zero");if(o<-a)throw Error("Upper f is less than zero");for(;i<-a;){let a=(t+n)/2,s=e(a);s<=0?(t=a,i=s):(n=a,o=s)}return t}(e=>{let t=(e-this.x)/(a-this.t),n=1/(a-this.t);return 2*this.gamma*n*(t-this.v)-1/(e-r)+1/(i-e)},r,i),u=(l-this.x)/(a-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*u,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(l,this.x),this.t=a,this.smoother_done=this.model_done&&this.x>=this.totalCompletionLength,this.stats.push({t:a,x:l,v:u,min_chars:r,max_chars:i}),I(this.blockOperations,this.blocksList,this.x)}addBlock(e,t){this.blocksList.push(t)}updateBlock(e,t){this.blocksList[e]=t}getBlocks(){return this.blocksList}onMessage(e){switch(e.type){case"content_block_start":{let t=this.blockOperations.createBlockFromStartEvent(e);null!==t&&this.addBlock(e.index,t);break}case"content_block_delta":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.applyDeltaEvent(e,t);this.updateBlock(e.index,n);break}case"content_block_stop":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.stopBlockEvent(e,t);this.updateBlock(e.index,n);break}case"message_stop":this.model_done=!0}0===this.start&&(this.start=Date.now());let t=N(this.blockOperations,this.blocksList);if(this.totalCompletionLength=t,this.arrivals.push([(Date.now()-this.start)/1e3,t]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.blocksList);this.on_completion(e)}}async task(e,t){for(;!this.smoother_done&&!t.aborted;){if(this.blocksList.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}await new Promise(e=>setTimeout(e,B))}}constructor(e){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.dont_smooth=!1,this.model_done=!1,this.smoother_done=!1,this.stats=[],this.blocksList=[],this.blockOperations=e}}(a=o||(o={}))[a.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",a[a.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",(i=s||(s={})).Ping="ping",i.Completion="completion",i.Error="error",i.ContentBlockDelta="content_block_delta",i.ContentBlockStart="content_block_start",i.ContentBlockStop="content_block_stop",i.MessageDelta="message_delta",i.MessageStart="message_start",i.MessageStop="message_stop",i.MessageLimit="message_limit";let R=["close_file","create_file","delete_file","draw_svg","file_search","open_file","repl","str_replace","update_file"];async function Q(e){let t,n,{applicationType:a,endpoint:i,orgUuid:o,conversationUuid:s,body:r,onCompletion:l,onInvokeTool:u,abortController:c,completion:d,getTools:p,smoothingEnabled:h=!0,shouldUseNewSmoother:m,redactedStrings:g}=e,_=m?(t={},n=!1,new Z({blockSize:e=>{if("text"===e.type)return e.text.length;if("thinking"===e.type)return e.thinking.length;if("tool_use"===e.type){var t;return(null===(t=e.partial_json)||void 0===t?void 0:t.length)||0}return e.type,0},sliceBlock:(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null===(n=e.partial_json)||void 0===n?void 0:n.slice(0,t)}}return"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:e},createBlockFromStartEvent:e=>("thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block),applyDeltaEvent:(e,a)=>{var i,o;switch(a.type){case"text":switch(n=!1,e.delta.type){case"text_delta":return{...a,text:a.text+e.delta.text};case"citation_start_delta":{let n=e.delta.citation;return t={...t,[n.uuid]:{...n,start_index:a.text.length}},a}case"citation_end_delta":{let n=e.delta.citation_uuid;return{...a,citations:(null!==(i=a.citations)&&void 0!==i?i:[]).concat({...t[n],end_index:a.text.length})}}default:return a}case"thinking":switch(n=!0,e.delta.type){case"thinking_delta":return{...a,thinking:a.thinking+e.delta.thinking};case"thinking_summary_delta":return{...a,summaries:[...a.summaries||[],e.delta.summary]};case"thinking_cut_off_delta":return{...a,cut_off:e.delta.cut_off};default:return a}case"tool_result":if(n=!1,"input_json_delta"===e.delta.type)return{type:"tool_result",tool_use_id:"",name:"",is_error:!1,content:[{type:"text",text:e.delta.partial_json}]};return a;case"tool_use":if(n=!1,"input_json_delta"===e.delta.type)return{...a,partial_json:(null!==(o=a.partial_json)&&void 0!==o?o:"")+e.delta.partial_json};return a}},stopBlockEvent:(e,t)=>"thinking"===t.type?{...t,stop_timestamp:e.stop_timestamp}:t,getBlockDeadlineOffset(){if(n)return 3}})):new D({redactedStrings:g});_.dont_smooth=!h,_.on_completion=l;let v=h?_.task(l,c.signal):Promise.resolve(),y={"Content-Type":"application/json",Accept:"text/event-stream",...(0,L.F)(a)},k=null,x=null,w=JSON.stringify({...d,...r,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),C="",j="",S="",M=0,T=(0,z.L)(function(e,t,n){let a;if(void 0===t||void 0===n)throw Error("Missing org uuid or conversation uuid");switch(e){case 1:a="completion";break;case 2:a="retry_completion";break;default:throw Error("Invalid endpoint")}return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/").concat(a)}(i,o,s),{method:"POST",credentials:"include",headers:y,body:w,openWhenHidden:!0,signal:c.signal,async onopen(e){var t;if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes(z.a))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,f.fT)(e.status,n,"Failed to fetch",e.headers)}},onmessage:m?e=>{var t,n;switch(e.event){case"ping":default:return;case"completion":{let n=JSON.parse(e.data);if(void 0===n.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let a={type:"content_block_delta",index:0,delta:{type:"text_delta",text:n.completion}};k=n.stop_reason,x=null!==(t=n.messageLimit)&&void 0!==t?t:null,_.onMessage(a);break}case"content_block_start":{let t=JSON.parse(e.data);M=t.index,"tool_use"===t.content_block.type&&(j=t.content_block.name,S=t.content_block.id),_.onMessage(t);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==M&&"thinking_summary_delta"!==t.delta.type)throw Error("Content block index did not match the expected index");(null===(n=t.delta)||void 0===n?void 0:n.type)==="input_json_delta"&&(R.includes(j)||p().some(e=>e.name===j))&&(C+=t.delta.partial_json),_.onMessage(t);break}case"content_block_stop":{let t=JSON.parse(e.data);if(t.index!==M)throw Error("Content block index did not match the expected index");if(_.onMessage(t),!j)break;u(s,j,S,C),C="",j="",S="";break}case"message_limit":x=JSON.parse(e.data).message_limit;break;case"message_delta":case"message_start":case"message_stop":{let t=JSON.parse(e.data);"message_stop"===t.type&&(k="message_stop"),_.onMessage(t)}}}:e=>{var t,n;switch(e.event){case"ping":default:return;case"error":throw(0,f.fT)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let n=JSON.parse(e.data);if(void 0===n.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let a={type:"content_block_delta",index:0,delta:{type:"text_delta",text:n.completion}};k=n.stop_reason,x=null!==(t=n.messageLimit)&&void 0!==t?t:null,_.onMessage(a);break}case"content_block_start":{let t=JSON.parse(e.data);M=t.index,"tool_use"===t.content_block.type&&(j=t.content_block.name,S=t.content_block.id),_.onMessage(t);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==M&&"thinking_summary_delta"!==t.delta.type)throw Error("Content block index did not match the expected index");(null===(n=t.delta)||void 0===n?void 0:n.type)==="input_json_delta"&&(R.includes(j)||p().some(e=>e.name===j))&&(C+=t.delta.partial_json),_.onMessage(t);break}case"content_block_stop":{let t=JSON.parse(e.data);if(t.index!==M)throw Error("Content block index did not match the expected index");if(_.onMessage(t),!j)break;u(s,j,S,C),C="",j="",S="";break}case"message_delta":case"message_start":case"message_stop":case"message_limit":{let t=JSON.parse(e.data);"message_stop"===t.type&&(k="message_stop"),"message_limit"===t.type&&(x=t.message_limit),_.onMessage(t)}}},onclose(){_.model_done=!0},onerror(e){throw e instanceof f.Hx&&529===e.statusCode||(0,b.Tb)(e),_.model_done=!0,_.smoother_done=!0,e}});return await Promise.all([T,v]),{stopReason:k,messageLimitResult:x}}var U=n(1146),F=n(77879),J=n(78230),A=n(49185),H=n(57271);let W=(0,T.createContext)([null,null]);function q(e){let{children:t}=e,n=(0,T.useState)({});return(0,r.jsx)(W.Provider,{value:n,children:t})}function Y(e,t,n){let{onIncrementalCompletion:a,onStartAppend:i,onStreamCompleted:s}=(0,H.p)(),r=et({conversationUUID:e,endpoint:o.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:a,onStreamCompleted:s,onInvokeTool:t,getTools:n}),{runStream:l}=r,u=(0,T.useCallback)(async t=>{let{prompt:n,attachments:a,files:o,syncSources:s,rethrowErrors:r=!1,modelOverride:u,parent_message_uuid:c,personalized_style:d}=t;await i(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,U.HX)(e),i=[{uuid:U.wZ,content:[{type:"text",text:n,citations:[]}],created_at:new Date().toISOString(),sender:"human",attachments:a,files:o,files_v2:o,sync_sources:s,index:t+1,parent_message_uuid:null!=c?c:U.QC},{uuid:U.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:t+2,parent_message_uuid:U.wZ}];return(0,U.vv)(e,i)}),await l({prompt:n,attachments:a,files:o,syncSources:s,rethrowErrors:r,modelOverride:u,parent_message_uuid:c,personalized_style:d})},[l,i,e]);return{...r,runStream:u}}function K(e,t,n,a){let{onIncrementalCompletion:i,onStreamCompleted:s,onStartAppend:r}=(0,H.p)(),l=et({conversationUUID:e,endpoint:o.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:i,onInvokeTool:t,onStreamCompleted:s,getTools:n}),{runStream:u}=l,c=(0,T.useCallback)(async(t,n)=>{await r(e,e=>{let n=[{uuid:U.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,U.HX)(e)+1}];return(0,U.vv)(e,n)}),await u({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:a,paprika_mode:n,isRetry:!0})},[e,u,r,a]);return{...l,runStream:c}}let G="incomplete_stream",V=e=>{var t,n;let a=$(e),{config:i}=(0,O.useExperiment)("tepui_default_on_claude_free"),o=null==i?void 0:null===(t=i.get("console_default_model_override",null))||void 0===t?void 0:t.model,{layer:s}=(0,O.useLayer)("frontend"),r=null===(n=s.get("console_default_model_override",null))||void 0===n?void 0:n.model,{config:l}=(0,O.useConfig)("console_default_model"),u=l.get("model",null);return a||o||r||u||"claude-2.1"},$=e=>{let t=(0,l.cE)(e||""),n=(0,M.useSearchParams)(),a=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:a||void 0},X={value:null},ee=()=>{let e=(0,w.useQueryClient)();return{failedStreamRetryData:(0,C.useQuery)({queryKey:[y.sf],queryFn:()=>X.value,initialData:null}).data||null,setFailedStreamRetryData:(0,T.useCallback)(t=>{X.value=t,e.setQueryData([y.sf],t)},[e])}};function et(e){var t;let{conversationUUID:n,endpoint:a,getTools:i,onIncrementalCompletion:o,onInvokeTool:s,onStreamCompleted:y}=e,{applicationType:w}=(0,d.m)(),{activeOrganization:C}=(0,p.t)(),{value:L}=(0,v.F)("apps_no_smoothing"),P=null==C?void 0:C.uuid,{getRemoteMcpTools:D}=(0,m.$)(),{value:z}=(0,v.F)("apps_use_new_smoother"),{context:N,clearContext:I,setContext:B}=function(e){let[t,n]=(0,T.useContext)(W),[a,i]=(0,T.useState)(),o=(0,T.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):i(void 0)},[e,n]),s=(0,T.useCallback)(t=>{n?n(n=>({...n,[e]:t})):i(t)},[e,n]);return{context:t?t[e]:a,clearContext:o,setContext:s}}(n),Z=(0,M.useSearchParams)(),R=null==Z?void 0:Z.get("t"),U=(0,k.zO)(),H=null!==(t=$(n))&&void 0!==t?t:"",q=null==Z?void 0:Z.get("max_tokens"),Y=(0,A.n)(),{addError:K,clearToast:V}=(0,h.e)(),X=(0,T.useMemo)(x.H,[]),et=(0,l.$H)("push",X),{setFailedStreamRetryData:en}=ee(),ea=(0,T.useCallback)(async e=>{await (null==y?void 0:y(n,e)),I()},[y,n,I]),ei=(0,T.useCallback)((e,t,a)=>{if(e===G)return K((0,r.jsx)("p",{children:(0,r.jsx)(E.Z,{defaultMessage:"Claude’s response was interrupted. Please check your network connection or <link>contact support</link> if the issue persists.",id:"C83ex9tIjX",values:{link:e=>(0,r.jsx)(S.default,{href:"https://support.anthropic.com/en/articles/9015913-how-to-get-support",className:"underline",children:e})}})}));if(!(e instanceof f.Hx))return K((0,r.jsx)(E.Z,{defaultMessage:"We couldn’t connect to Claude. Please check your network connection and try again.",id:"KzO0j4cGtg"}));if("rate_limit_error"===e.type){if(e.message.includes("{")&&P)try{let t=JSON.parse(e.message);Y(t,P,n)}catch(e){}return K((0,r.jsxs)("p",{children:[(0,r.jsx)(E.Z,{defaultMessage:"You’ve reached the limit for Claude messages at this time. Please wait before trying again.",id:"CBMEJMlMzs"}),"\xa0",(0,r.jsx)(u.o,{})]}))}if("not_found_error"===e.type)return K((0,r.jsx)(E.Z,{defaultMessage:"Claude model version not found.",id:"kdrUaXpTqd"}));if("billing_error"===e.type)return K((0,r.jsx)("p",{children:(0,r.jsx)(E.Z,{defaultMessage:"We had an unexpected billing error, please <link>contact support.</link>",id:"MBYn4HHrFu",values:{link:e=>(0,r.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:e})}})}));if("overloaded_error"===e.type)return K((0,r.jsxs)("p",{children:[(0,r.jsx)(E.Z,{defaultMessage:"Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",id:"TRpxX8Mu1L"}),(0,r.jsx)(u.o,{})]}));if("exceeded_max_uploads_per_message"===e.errorCode){K((0,r.jsx)(E.Z,{defaultMessage:"Your message will exceed the maximum number of files allowed per message. Consider removing some of your files or adding files over several messages.",id:"/jNwaAHdg9"}));return}if("exceeded_max_image_limit_per_chat"===e.errorCode){let e=K((0,r.jsx)("p",{children:a>0?(0,r.jsx)(E.Z,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try uploading {count, plural, one {# document} other {# documents}} with fewer pages, removing images, <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"gltmHPfviz",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g._R,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),et(),V(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(u.o,{}),count:a}}):(0,r.jsx)(E.Z,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try removing images <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"QmLhKBubcc",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g._R,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),et(),V(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(u.o,{})}})}));return}if("invalid_request_error"===e.type&&413===e.statusCode){let e=K((0,r.jsx)("p",{children:t>0?(0,r.jsx)(E.Z,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try attaching fewer or smaller files <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"G1lejdsk5p",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g.jC,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),et(),V(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(u.o,{})}}):(0,r.jsx)(E.Z,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try shortening your message <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"EWtBrIlAAR",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g.jC,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),et(),V(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(u.o,{})}})}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?K((0,r.jsx)("p",{children:(0,r.jsx)(E.Z,{defaultMessage:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while.",id:"W2dIBW8oIg"})})):K(e)},[K,P,Y,n,et,V]),eo=(0,c.z$)(),es=function(){let{height:e,width:t}=(0,F.iP)(),n=[];return n.length?n.join("\n"):null}(),{config:er}=(0,O.useExperiment)("no_more_smoother"),el=(0,T.useCallback)(async e=>{let{prompt:t,attachments:r,files:l,syncSources:u,rethrowErrors:c=!1,modelOverride:d,parent_message_uuid:p,personalized_style:h,isRetry:m=!1,paprika_mode:f}=e;if(N)return;if(!C)throw Error("Cannot stream without an organization");let g=new AbortController;B({controller:g}),en(null);let v={prompt:t,parent_message_uuid:p,timezone:j.ou.local().zoneName||void 0,personalized_styles:h?[h]:void 0},y=(0,J.l)();(y||es)&&(v.custom_system_prompt=[y,es].filter(Boolean).join("\n")),H&&"string"==typeof H&&(v.model=H),d&&(v.model=d),"string"==typeof R&&(v.temperature=parseInt(R)),q&&"string"==typeof q&&(v.max_tokens_to_sample=parseInt(q)),m&&f&&(v.paprika_mode=f);let k=i();k.length&&(v.tools=k);let x=D();x.length>0&&(v.tools=[...k,...x]);let S=[],M=null,T=null,E=null;try{let e=er.get("no_smoothing",!1);M=(E=await Q({applicationType:w,endpoint:a,orgUuid:C.uuid,conversationUuid:n,body:{organization_uuid:C.uuid,conversation_uuid:n,text:t,attachments:r,files:l.map(e=>e.file_uuid),sync_sources:u.map(e=>e.uuid)},onCompletion:e=>{o(n,e),S=e},onInvokeTool:s,abortController:g,completion:v,getTools:i,smoothingEnabled:!L&&!e,shouldUseNewSmoother:z,redactedStrings:U})).stopReason,T=E.messageLimitResult}catch(e){if(en({prompt:t,attachments:r,files:l}),ei(e,r.length+l.length,l.filter(e=>"document"===e.file_kind).length),(0,b.Tb)(e),c||(0,_.yG)())throw e}finally{E&&!M&&(o(n,S),ei(G,r.length+l.length,l.filter(e=>"document"===e.file_kind).length),eo.track({event_key:"sse_interrupted"}),(0,b.uT)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))),await ea(T)}return S},[N,C,B,en,es,H,R,q,i,D,er,w,a,n,s,L,z,U,o,ei,ea,eo]),eu=(0,T.useCallback)(()=>{N&&(N.controller.abort(),ea(null))},[N,ea]);return{runStream:el,isStreaming:!!N,abortStream:eu}}},78230:function(e,t,n){n.d(t,{h:function(){return o},l:function(){return s}});var a=n(7653);let i="customSystemPrompt",o=()=>{let[e,t]=(0,a.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(i)||"");return(0,a.useEffect)(()=>{localStorage.setItem(i,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},s=()=>"undefined"==typeof localStorage?"":localStorage.getItem(i)},76220:function(e,t,n){n.d(t,{V:function(){return u},u:function(){return c}});var a=n(5362),i=n(27218),o=n(14448),s=n(13262),r=n(15992);let l={image_in:!1,pdf_in:!1},u=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,{data:r,isLoading:u,isPlaceholderData:c}=(0,a.WE)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[s.Qn,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}}),d=!c&&r||l,{value:p}=(0,o.F)("claude_ai_cinnamon");return"claude-3-5-haiku-20241022"===e&&p&&(d={image_in:!0,pdf_in:!1}),{isLoading:u,modelConfig:d}},c=()=>{let{config:e}=(0,r.useConfig)("claude_ai_models"),t=e.get("models",[]),n=t.filter(e=>!e.inactive),a=n.filter(e=>!e.overflow),i=n.filter(e=>e.overflow);return{allModelOptions:t,activeModelOptions:n,mainModels:a,overflowModels:i}}},49185:function(e,t,n){n.d(t,{I:function(){return u},n:function(){return l}});var a=n(5362),i=n(27218),o=n(13262),s=n(77930),r=n(7653);let l=()=>{let e=(0,s.useQueryClient)();return(0,r.useCallback)((t,n,a)=>{"within_limit"!==t.type&&(t.conversationUUID=a),e.setQueryData([o.aY],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},u=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,o=l(),s={type:"within_limit"};return(0,a.uC)(()=>"/api/organizations/".concat(n,"/reset_rate_limits"),"POST",{onSuccess:()=>{o(s,n,e||"")},meta:{noToast:!0}})}},57271:function(e,t,n){n.d(t,{p:function(){return u}});var a=n(27218),i=n(13262),o=n(77930),s=n(7653),r=n(1146),l=n(49185);let u=()=>{let e=(0,o.useQueryClient)(),{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,u=(0,s.useRef)(),c=(0,l.n)(),d=(0,s.useCallback)(async(t,a)=>{let o=[i.I8,{orgUUID:n},{uuid:t}],s=e.getQueryData(o);if(!s)throw Error("Conversation tree must be provided for append");let r=a(s);u.current=r,await e.cancelQueries({queryKey:o}),e.setQueryData(o,u.current)},[e,n]),p=(0,s.useCallback)((t,a)=>{0!==a.length&&e.setQueryData([i.I8,{orgUUID:n},{uuid:t}],()=>{let e=u.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=a,{...e,created_at:new Date().toISOString()}})},[e,n]);return{onStartAppend:d,onStreamCompleted:(0,s.useCallback)(async(t,a)=>{let o=[i.I8,{orgUUID:n},{uuid:t}];u.current=void 0,a?(e.setQueryData([i.tv,{orgUUID:n}],e=>{if(!e)return;let n=e.find(e=>e.uuid===t);return n?[{...n,updated_at:new Date().toISOString()},...e.filter(e=>e.uuid!==t)]:e}),await e.invalidateQueries({queryKey:o})):e.invalidateQueries({queryKey:o}),a&&n&&c(a,n,t)},[e,c,n]),onIncrementalCompletion:p,changeDisplayedConversationPath:(0,s.useCallback)((t,a,o,s)=>{e.setQueryData([i.I8,{orgUUID:n},{uuid:t}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,r.mj)(e,a,o);return t.current_leaf_message_uuid&&s&&s(t.current_leaf_message_uuid),t})},[e,n])}}},66092:function(e,t,n){n.d(t,{$:function(){return o}});var a=n(7653),i=n(18013);function o(){let[e,t]=(0,i.R)("mcp-enabled-tools",{}),n=(0,a.useCallback)((e,n)=>{t(t=>({...t,[e]:n}))},[t]),o=(0,a.useCallback)(t=>!!e[t],[e]),s=(0,a.useCallback)(()=>{let t=Object.entries(e).filter(e=>{let[t,n]=e;return n}).map(e=>{let[t]=e;return t});return 0===t.length?[]:t.map(e=>({type:"remote_mcp_v0",name:e}))},[e]);return{enabledTools:e,setEnabledTools:t,toggleTool:n,isToolEnabled:o,getRemoteMcpTools:s}}},66894:function(e,t,n){n.d(t,{Ry:function(){return o},cm:function(){return i},yG:function(){return a}}),n(68571);let a=()=>!1,i=()=>!1,o=()=>i()||a()},91598:function(e,t,n){n.d(t,{fs:function(){return s},lR:function(){return o},zO:function(){return r}});var a=n(7653),i=n(15992);let o="echo_forest_path",s="dream_circuit_wave";function r(){let e=(0,i.useConfig)("apps_redacted_strings_paprika"),t=(0,i.useConfig)("apps_redacted_strings_sherlock");return(0,a.useMemo)(()=>({...e.config.value,...t.config.value}),[t.config.value,e.config.value])}}}]);