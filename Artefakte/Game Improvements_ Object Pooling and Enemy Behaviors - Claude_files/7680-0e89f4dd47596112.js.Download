"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7680],{18187:function(e,t,n){n.d(t,{HN:function(){return u},SE:function(){return s},Tx:function(){return l}});var r=n(5362),i=n(27218),a=n(13262),o=n(77930),c=n(32559);let u=(e,t)=>{let{account:n,activeOrganization:u}=(0,i.t)(),s=t===(null==n?void 0:n.uuid),l=null==u?void 0:u.uuid,d=(0,o.useQueryClient)(),f=(0,c.Gm)();return(0,r.uC)(()=>"/api/organizations/".concat(l,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries({queryKey:[a.l3,{projectUuid:e}]}),s&&(f(e),d.invalidateQueries({queryKey:[a.VH,{orgUUID:l}]}),d.invalidateQueries({queryKey:[a.tv,{orgUUID:l}]}))}})},s=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.t)(),o=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[a.l3,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0})},l=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,c=(0,o.useQueryClient)();return(0,r.uC)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{c.invalidateQueries({queryKey:[a.l3,{projectUuid:e}]})},transformVariables:e=>({role:e.role})})}},47082:function(e,t,n){n.d(t,{M:function(){return d},Y:function(){return f}});var r=n(27573),i=n(35919),a=n.n(i),o=n(7653);function c(e,t){switch(t.type){case"DRAW_SVG":return{...e,selectedItem:{type:"svg",data:t.svg}};case"OPEN_COMPASS_STATUS":return{...e,selectedItem:{type:"compass",data:t.data}};case"OPEN_COMPASS_RESULT":return{...e,selectedItem:{type:"compass_result",data:t.data}};case"SELECT_ATTACHMENT":return{...e,selectedItem:{type:"attachment",attachment:t.attachment}};case"SELECT_ARTIFACT":return{...e,selectedItem:{type:"artifact",id:t.id,versionUUID:t.versionUUID}};case"SELECT_DOC":return{...e,selectedItem:{type:"doc",id:t.id}};case"SELECT_SYNCED_DIRECTORY":return{...e,selectedItem:{type:"syncedDirectory",id:t.id}};case"CLEAR_SELECTED":return{...e,selectedItem:null,activeMessageUUID:void 0};case"SET_ACTIVE_MESSAGE_UUID":return{...e,activeMessageUUID:t.uuid};case"UPDATE_ARTIFACTS":return{...e,artifacts:t.artifacts};case"UPDATE_ATTACHMENTS":return{...e,attachments:t.attachments};case"UPDATE_FILES":return{...e,files:t.files};case"UPDATE_SYNC_SOURCES":return{...e,syncSources:t.syncSources};case"UPDATE_DOC_UPDATES":return{...e,docUpdates:t.updates};case"UPDATE_FILE_EDITS":return{...e,fileEdits:t.edits};default:return e}}let u={selectedItem:null,artifacts:{},attachments:[],files:[],syncSources:[],docUpdates:[],fileEdits:new Map,activeMessageUUID:void 0,conversationUUID:void 0},s={chatResourceState:u,dispatchChatResource:a()},l=(0,o.createContext)(s);function d(e){let{children:t,conversationUUID:n}=e,[i,a]=(0,o.useReducer)(c,{...u,conversationUUID:n});return(0,r.jsx)(l.Provider,{value:{chatResourceState:i,dispatchChatResource:a},children:t})}function f(){return(0,o.useContext)(l)}},7680:function(e,t,n){n.d(t,{r:function(){return w},s:function(){return v}});var r=n(27573),i=n(3053),a=n(80762),o=n(28346),c=n(24558),u=n.n(c),s=n(35919),l=n.n(s),d=n(7653),f=n(47082),h=n(40030);let m=(0,d.createContext)(null),p={getInstance:()=>void 0,setBaseContent:l(),flagForDeletion:l(),getCurrentContent:()=>void 0,hasUnsavedChanges:()=>!1,registerEditor:l(),unregisterEditor:l(),setMergeState:()=>l(),subscribeToMergeStateChanges:()=>l(),acceptAllChanges:l(),rejectAllChanges:l(),deactivateChangesMode:l(),activeEditors:[],changesMode:!1},y=(e,t)=>{var n,r;let i=null===(r=(0,o.Sk)(e.state))||void 0===r?void 0:null===(n=r.chunks)||void 0===n?void 0:n[0];return!!i&&("accept"===t?o.bN:o.A)(e,i.fromB)};function w(e){let{children:t}=e,{track:n}=(0,i.z$)(),{openedFiles:o}=(0,h.b)(),{dispatchChatResource:c}=(0,f.Y)(),s=(0,d.useRef)(new Map),l=(0,d.useRef)(new Set),p=(0,d.useCallback)((e,t)=>{s.current.set(e,{view:t})},[]),w=(0,d.useCallback)(e=>{s.current.delete(e)},[]),v=(0,d.useCallback)((e,t)=>{let n=s.current.get(e);if(!n){a.v("Attempted to update unknown editor: ".concat(e));return}s.current.set(e,{...n,...t})},[]),g=(0,d.useCallback)((e,t)=>v(e,{baseContent:t}),[v]),E=(0,d.useCallback)(e=>v(e,{filePendingDeletion:!0}),[v]),C=(0,d.useCallback)((e,t)=>{v(e,{mergeState:t}),l.current.forEach(n=>n(e,t))},[v]),U=(0,d.useCallback)(e=>(l.current.add(e),()=>{l.current.delete(e)}),[]),I=(0,d.useCallback)(e=>s.current.get(e),[]),[S,_]=(0,d.useState)([]),[T,b]=(0,d.useState)(!1),D=(0,d.useCallback)(()=>{c({type:"UPDATE_FILE_EDITS",edits:new Map}),b(!1)},[c]);(0,d.useEffect)(()=>{S.length&&b(!0)},[S]),(0,d.useEffect)(()=>(_(o.filter(e=>{var t;let n=I(e);return!!n&&(null===(t=n.mergeState)||void 0===t?void 0:t.isActive)&&!!n.view})),U((e,t)=>{_(n=>{var r;let i=n.includes(e),a=t.isActive&&!!(null===(r=I(e))||void 0===r?void 0:r.view);return i===a?n:a?[...n,e]:n.filter(t=>t!==e)})})),[o,U,I,T]);let P=(0,d.useCallback)(()=>{S.forEach(e=>{var t;let n=null===(t=I(e))||void 0===t?void 0:t.view;if(n)for(;y(n,"accept"););}),n({event_key:"harmony.suggestion.accepted"})},[S,n,I]),x=(0,d.useCallback)(()=>{S.forEach(e=>{var t;let r=null===(t=I(e))||void 0===t?void 0:t.view;if(r){for(;y(r,"reject"););C(e,{isActive:!1}),n({event_key:"harmony.suggestion.rejected"})}})},[S,n,I,C]),A=(0,d.useCallback)(e=>{var t,n;return null===(n=I(e))||void 0===n?void 0:null===(t=n.view)||void 0===t?void 0:t.state.doc.toString()},[I]),M=(0,d.useCallback)(e=>{var t;let n=A(e);return u()(n)&&n!==(null===(t=I(e))||void 0===t?void 0:t.baseContent)},[A,I]),j=(0,d.useMemo)(()=>({getInstance:I,setBaseContent:g,flagForDeletion:E,getCurrentContent:A,hasUnsavedChanges:M,registerEditor:p,unregisterEditor:w,setMergeState:C,subscribeToMergeStateChanges:U,acceptAllChanges:P,rejectAllChanges:x,deactivateChangesMode:D,activeEditors:S,changesMode:T}),[I,g,E,A,M,p,w,C,U,P,x,D,S,T]);return(0,r.jsx)(m.Provider,{value:j,children:t})}function v(){return(0,d.useContext)(m)||p}},71844:function(e,t,n){n.d(t,{KA:function(){return s},Nc:function(){return u},YB:function(){return c},b8:function(){return a},h4:function(){return o}});var r=n(39160),i=n.n(r);function a(e,t){return i()(e,t)}function o(e){let t=[],n=0;for(let[r,i]of e)0!==r&&t.push({op:r,pos:n,text:i}),-1!==r&&(n+=i.length);return t}function c(e){if(!Array.isArray(e))throw Error("Input must be an array");e.forEach((e,t)=>{if(!("object"==typeof e&&null!==e&&"op"in e&&"number"==typeof e.op))throw Error("Invalid change object at index ".concat(t));if(1!==e.op&&-1!==e.op)throw Error("Invalid 'op' value at index ".concat(t));if("number"!=typeof e.pos||!Number.isInteger(e.pos))throw Error("Invalid 'pos' value at index ".concat(t));if("string"!=typeof e.text)throw Error("Invalid 'text' value at index ".concat(t))})}function u(e,t){return function(e,t){let n=e,r=0;for(let e of t){let t=e.pos+r;1===e.op?(n=n.slice(0,t)+e.text+n.slice(t),r+=e.text.length):-1===e.op&&(n=n.slice(0,t)+n.slice(t+e.text.length),r-=e.text.length)}return n}(e,t.map(e=>({op:-e.op,pos:e.pos,text:e.text})).reverse())}function s(e){for(let[t]of e)if(0!==t)return!1;return!0}},28096:function(e,t,n){function r(e){var t;return(null===(t=e.mergeState)||void 0===t?void 0:t.isActive)?e.mergeState.diffSource:e.view.state.doc.toString()}function i(e){return r(e)!==e.baseContent}n.d(t,{li:function(){return r},oI:function(){return i}}),n(71844)},44506:function(e,t,n){n.d(t,{G:function(){return r}});async function r(e){let{createHash:t}=await Promise.all([n.e(2044),n.e(1919)]).then(n.t.bind(n,76736,23));return t("sha256").update(e.trim()).digest("hex").slice(0,6)}},18701:function(e,t,n){n.d(t,{Y:function(){return u}});var r=n(27218),i=n(14448),a=n(15992),o=n(18187),c=n(32559);let u=e=>{var t;let{account:n}=(0,r.t)(),{value:u}=(0,i.F)("force_harmony"),{data:s,isLoading:l}=(0,c.Yc)(e),{data:d,isLoading:f}=(0,o.SE)(e||""),h=null!==(t=null==d?void 0:d.some(e=>e.account.uuid===(null==n?void 0:n.uuid)&&"user"===e.role))&&void 0!==t&&t,m="showDirectoryPicker"in window&&"FileSystemHandle"in window,p=(0,a.useConfig)("harmony").config;return{userHasHarmony:m&&((null==n?void 0:n.settings.preview_feature_uses_harmony)||u)&&(null==p?void 0:p.get("harmonize",!1)),projectHasHarmony:!l&&!f&&h&&!!(null==s?void 0:s.is_harmony_project),config:p}}},40030:function(e,t,n){n.d(t,{C:function(){return C},b:function(){return U}});var r=n(27573),i=n(7653),a=n(35919),o=n.n(a);let c=(0,i.createContext)(null),u={openedFiles:[],projectDocs:[],files:[],setFiles:o(),projectUuid:"",syncedDirectories:[],setSyncedDirectories:o()};function s(e){let{children:t,onLoad:n}=e;return(0,i.useEffect)(n,[n]),(0,r.jsx)(c.Provider,{value:u,children:t})}var l=n(80762),d=n(87590),f=n.n(d),h=n(77879),m=n(95899),p=n(85017),y=n(10690),w=n(52902);let v=[];function g(e){let{children:t,onLoad:n,projectUuid:a}=e,{isLoading:o,unfilteredData:u=v}=(0,m.Kf)(a),[s,d]=(0,i.useState)([]),[g,E]=(0,i.useState)([]),C=(0,i.useMemo)(()=>[...(function(e,t){let n=new Map,r=t.filter(w.IQ).map(e=>e.uri);if(!r.length)return n;for(let t of r){let r=new Set;for(let n of e){if(!(0,w.Wx)(n.file_name))continue;let{projectUuid:e,directoryUuid:i}=(0,w.Xp)(n.file_name),a=(0,w.Xp)(t);e===a.projectUuid&&i===a.directoryUuid&&r.add(n.file_name)}n.set(t,r)}return n})(u,s).values()].flatMap(e=>[...e]),[u,s]);(0,i.useEffect)(()=>{(0,p.Zz)(a).then(E).catch(e=>l.v("Harmony: Error initializing synced directories from IndexedDB",e))},[a]);let{mutateAsync:U}=(0,m.u3)(a),{mutateAsync:I}=(0,m.Zy)(a),{mutateAsync:S}=(0,m.ER)(a),_=(0,i.useCallback)(()=>{(0,y.tt)(a,o,s,u,U,I,S).then(e=>{e&&(f()(s,e.updatedFiles)||(d(e.updatedFiles),l.f("Harmony: Resynced ".concat(e.updatedFiles.filter(w.zE).length," files in ").concat(e.updatedFiles.filter(w.IQ).length," directories")),n()))}).catch(e=>l.v("Harmony: Error during resync:",e))},[a,o,s,u,U,I,S,n]),T=(0,i.useRef)(!1);(0,i.useEffect)(()=>{!a||o||T.current||(T.current=!0,_())},[_,a,o]),(0,h.Yz)(_,3e4);let b=(0,i.useMemo)(()=>({projectUuid:a,openedFiles:C,projectDocs:u,files:s,setFiles:d,syncedDirectories:g,setSyncedDirectories:E}),[a,C,u,s,g,E]);return(0,r.jsx)(c.Provider,{value:b,children:t})}var E=n(18701);function C(e){let{children:t,onLoad:n,projectUuid:i}=e,{userHasHarmony:a}=(0,E.Y)(i);return a?(0,r.jsx)(g,{onLoad:n,projectUuid:i,children:t}):(0,r.jsx)(s,{onLoad:n,children:t})}function U(){return(0,i.useContext)(c)||u}},85017:function(e,t,n){n.d(t,{Gz:function(){return h},U4:function(){return m},Zz:function(){return d},sN:function(){return f},y3:function(){return p}});var r=n(80762),i=n(51432),a=n(52902);let o="directories",c="projectUuid",u=null;async function s(){return u||new Promise((e,t)=>{let n=indexedDB.open("harmony",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{(u=n.result).onerror=e=>{r.v("Database error:",e)},u.onclose=()=>{u=null},e(u)},n.onupgradeneeded=e=>{e.target.result.createObjectStore(o,{keyPath:"uuid"}).createIndex(c,"projectUuid",{unique:!1})}})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readonly";if(!u)throw Error("Database not initialized");return u.transaction(o,e)}async function d(e){await s();let t=l("readonly").objectStore(o).index(c);return new Promise((n,r)=>{let i=t.getAll(e);i.onerror=()=>r(i.error),i.onsuccess=()=>{n(i.result.map(e=>({...e,uri:(0,a.cT)(e)})))}})}async function f(e){await s();let t=l("readonly").objectStore(o);return new Promise((n,r)=>{let i=t.get(e);i.onerror=()=>r(i.error),i.onsuccess=()=>{if(i.result){let e=i.result;n({...e,uri:(0,a.cT)(e)})}else n(null)}})}async function h(e){await s();let t={...e,uuid:(0,i.H)()};return new Promise((e,n)=>{let i=l("readwrite").objectStore(o).add(t);i.onerror=()=>n(i.error),i.onsuccess=()=>{let n=(0,a.cT)(t);e({...t,uri:n}),r.f("Harmony: Synced directory added to IndexedDB",t)}})}async function m(e){return await s(),new Promise((t,n)=>{let r=l("readwrite").objectStore(o).put(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}async function p(e){return await s(),new Promise((t,n)=>{let r=l("readwrite").objectStore(o).delete(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}},10690:function(e,t,n){n.d(t,{Jl:function(){return m},wC:function(){return C},T7:function(){return S},bE:function(){return f},lz:function(){return I},xF:function(){return y},Zn:function(){return U},cM:function(){return E},tt:function(){return _},KT:function(){return h},ec:function(){return p}});var r=n(80762),i=n(87590),a=n.n(i),o=n(95899),c=n(71844),u=n(28096),s=n(44506),l=n(85017),d=n(52902);async function f(e){let t=await (0,l.Zz)(e);return await (0,d.C7)(t)}async function h(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=await Promise.all(t.filter(d.zE).map(async t=>({path:t.uri,content:await m(e,t.uri)})));return new Promise((e,t)=>{let c=new Worker(n.tu(new URL(n.p+n.u(231),n.b))),u=setTimeout(()=>{t(Error("Search timeout"))},3e4),s=()=>{c.terminate(),clearTimeout(u)};c.onerror=e=>{s(),t(e)};let l=[];c.onmessage=t=>{let{type:n,results:r}=t.data;l.push(...r),"complete"===n&&(s(),e(l))},c.postMessage({files:o,searchTerm:r,isRegex:i,caseSensitive:a})})}async function m(e,t){return(await (0,d.pJ)(e,t)).text}async function p(e,t,n,i,a,o){let s=await (0,l.Zz)(t),f=Array.from(new Set([...e])).map(async e=>{if((0,d.Wx)(e))try{let t=o(e),l=t?(0,u.li)(t):void 0,d=t?t.baseContent:void 0;if(void 0===d||void 0===l){let t=await m(s,e);if(!l){if(null===t){r.v(Error("File content not found for ".concat(e)));return}return await w(n,i,a,e,t,[])}return await w(n,i,a,e,l,(0,c.b8)(t||"",l))}let f=(0,c.b8)(d,l);return await w(n,i,a,e,l,f)}catch(t){r.v("Error processing file ".concat(e,":"),t)}});await Promise.all(f)}async function y(e,t,n,r,i){let a=await m(e,i);if(null===a)throw Error("File content not found for ".concat(i));if(new TextEncoder().encode(a).length>102400)throw Error("File ".concat(i," is too large and will degrade the experience. Pass a specific view_range when using the view tool for this file."));return await w(t,n,r,i,a)}async function w(e,t,n,r,i,a){let o=e.find(e=>e.file_name===r);if(o&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.match(/<content>([\s\S]*)<\/content>/),r=n&&n[1]?n[1].trim():e;if(t){let t=e.match(/<changes>(.*?)<\/changes>/);if(t&&t[1]){let e=JSON.parse(t[1]);(0,c.YB)(e),r=(0,c.Nc)(r,e)}}return r}(o.content)===i)return o;let u=await v(i,a);return o?await n({docUuid:o.uuid,content:u}):await t({file_name:r,content:u})}async function v(e,t){let n=await (0,s.G)(e),r=void 0!==t&&!(0,c.KA)(t);return"\n<metadata>\n<file_hash>".concat(n,"</file_hash>\n<file_state>\n  ").concat(r&&void 0!==t?"\n  <status>includes_unsaved_changes</status>\n  <message>This content includes modifications since it was last synchronized. You can and should continue to suggest changes using write or replace operations. Your suggestions will be applied to the latest version of the file. THIS IS THE MOST UP TO DATE VERSION OF THE FILE.</message>\n  <changes>".concat(JSON.stringify((0,c.h4)(t)),"</changes>\n"):"<status>synced</status>","\n</file_state>\n</metadata>\n<content>").concat(e,"</content>\n").trim()}async function g(e,t,n,i,a){if(0===e.length){let e=t.find(e=>e.file_name===o.i9);e&&await a({docUuid:e.uuid});return}let c=JSON.stringify(e.map(e=>e.uri),null,2).split("\n"),u=c.slice(0,50).join("\n"),s=c.length-50,l="<synced_resources>\n".concat(u,"\n").concat(s>0?"\n... plus ".concat(s," additional files."):"","\n</synced_resources>"),d=t.filter(e=>e.file_name===o.i9);if(d.length>0){let[e,...n]=d;if(n.length>0&&r.f("Harmony: Cleaning up ".concat(n.length," extra project docs")),await Promise.all(n.map(e=>E(t,e.file_name,a))),e.content===l){r.f("Harmony: Project doc already up to date",e.uuid);return}await i({docUuid:e.uuid,content:l}),r.f("Harmony: Updated project doc",e.uuid)}else{let e=await n({file_name:o.i9,content:l});r.f("Harmony: Created project doc",e.uuid)}}async function E(e,t,n){let r=e.find(e=>e.file_name===t);r&&await n({docUuid:r.uuid})}async function C(e,t,n,r){let{projectUuid:i,directoryUuid:a}=(0,d.Xp)(r),o=(0,d.wq)(e,i,a);for(let e of(await (0,l.y3)(a),t.filter(e=>I(e,o))))await n({docUuid:e.uuid});return e.filter(e=>e!==o)}async function U(e,t,n){let r=await (0,d.mf)(e,null!=n?n:[]);return await (0,l.Gz)({projectUuid:t,root:r,ignorePatterns:null!=n?n:[],lastUpdated:Date.now()})}function I(e,t){if(!(0,d.Wx)(e.file_name))return!1;let{projectUuid:n,directoryUuid:r}=(0,d.Xp)(t.uri),{projectUuid:i,directoryUuid:a}=(0,d.Xp)(e.file_name);return n===i&&r===a}function S(e){let t=e.split("/"),n=t[t.length-1],r=t[t.length-2];return""===n||"."===n?"".concat(r,"/"):n}async function _(e,t,n,r,i,o,c){if(!e||t)return;let u=await (0,l.Zz)(e),s=await (0,d.C7)(u);if(!a()(n.map(e=>e.uri),s.map(e=>e.uri))){for(let e of u)e.root.descendants.some(t=>t.lastModified>e.lastUpdated)&&await (0,l.U4)({...e,lastUpdated:Date.now()});return await g(s,r,i,o,c),{updatedFiles:s}}}},52902:function(e,t,n){n.d(t,{O:function(){return g},cn:function(){return y},_I:function(){return w},wq:function(){return U},sy:function(){return I},IQ:function(){return E},zE:function(){return C},Wx:function(){return R},C7:function(){return v},mf:function(){return D},Xp:function(){return j},pJ:function(){return f},cT:function(){return _},NC:function(){return h}});var r=n(5161),i=n(80762),a=n(98940);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}getCacheKey(e,t){return"".concat(e.name,"-").concat(t)}isPermissionExpired(e){return Date.now()-e>this.CACHE_DURATION}async checkPermission(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read",n=this.getCacheKey(e,t),r=this.permissionCache.get(n);if(r&&!this.isPermissionExpired(r.timestamp))return"granted"===r.state;try{if("queryPermission"in e){let r=await e.queryPermission({mode:t});if("granted"===r)return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}if("requestPermission"in e){let r=await e.requestPermission({mode:t});return"granted"===r&&this.permissionCache.set(n,{state:r,timestamp:Date.now(),mode:t}),"granted"===r}return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}catch(e){return i.v("Permission check failed:",e),!1}}constructor(){this.permissionCache=new Map,this.CACHE_DURATION=36e5}}let c=o.getInstance();async function u(e,t){return c.checkPermission(e,t)}var s=n(87376).Buffer;let l="inode/directory";async function d(e,t){let n=await e.getFile();return{handle:e,path:"".concat(t,"/").concat(n.name),lastModified:n.lastModified}}async function f(e,t){let n,i;let{directory:a,file:o}=I(e,t);if(!o)throw Error("File not found: ".concat(t));let c=await o.handle.getFile(),u=null;try{u=await (0,r.CL)(c),i=c.type||"text/plain"}catch(t){let e=await c.arrayBuffer();n=e.byteLength>1048576?"[File truncated due to size]":s.from(e).toString("base64"),i=c.type||"application/octet-stream"}return{uri:S(a,o),mimeType:i,text:u,blob:n}}async function h(e,t){if(!await u(e.handle,"readwrite"))throw Error("Permission denied");let n=await e.handle.getFile();try{await (0,r.CL)(n)}catch(e){throw Error("Cannot write to non-text files")}let a=await e.handle.createWritable();try{await a.write(t)}finally{await a.close()}i.f("Harmony: Wrote file ".concat(e.path," to local file system")),e.lastModified=Date.now()}async function m(e,t){try{return await e.getDirectoryHandle(t,{create:!0})}catch(e){throw Error("Failed to create directory ".concat(t))}}async function p(e,t){let n=e;for(let e=0;e<t.length-1;e++)n=await m(n,t[e]);return n}async function y(e,t,n){let{pathComponents:r}=F(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied");let i=await p(e.root.handle,r),a=r[r.length-1];try{let t={handle:await i.getFileHandle(a,{create:!0}),path:"".concat(e.root.name,"/").concat(r.join("/")),lastModified:Date.now()};return await h(t,n),e.root.descendants.push(t),!0}catch(e){throw Error("Failed to create file ".concat(t," - ").concat(e))}}async function w(e,t){let{pathComponents:n}=F(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied to delete file in the directory");let r=await p(e.root.handle,n),i=n[n.length-1];try{return await r.removeEntry(i),e.root.descendants=e.root.descendants.filter(t=>t.path!=="".concat(e.root.name,"/").concat(n.join("/"))),!0}catch(e){throw Error("Failed to delete file ".concat(i))}}async function v(e){return(await Promise.all(e.map(g))).flat()}async function g(e){try{if(await u(e.root.handle,"read")){let t=await P(e);t&&(e.root=t.updatedDirectoryRoot)}}catch(t){i.v("Harmony: Could not resync ".concat(e.uuid),t)}let t=e.root.descendants.map(t=>({uri:S(e,t)}));return t.unshift({uri:_(e),mimeType:l}),t}function E(e){return e.mimeType===l}function C(e){return!E(e)}function U(e,t,n){let r=e.find(e=>e.projectUuid===t&&e.uuid===n);if(!r)throw Error("Resource not found: ".concat(t,"/").concat(n));return r}function I(e,t){let{projectUuid:n,directoryUuid:r,pathComponents:i}=j(t),a=U(e,n,r);try{let e=function(e,t){let n="".concat(e.root.name,"/").concat(t.join("/")),r=e.root.descendants.find(e=>e.path===n);if(!r)throw Error("File not found: ".concat(n));return r}(a,i);return{directory:a,file:e}}catch(e){return{directory:a,file:null}}}function S(e,t){let n=t.path.split("/").map(encodeURIComponent);return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/")+n.join("/")}function _(e){return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/").concat(encodeURIComponent(e.root.name),"/")}async function T(e,t,n,r){let i=n.flatMap(e=>{if(""===(e=e.trim())||e.startsWith("#"))return[];let t=e.startsWith("!");return t&&(e=e.slice(1)),(e=e.replace(/^\//,"")).endsWith("/")&&(e+="*"),t?["!".concat(e)]:[e]}),o=[],c=[[e,t]],u=e=>{let t=i.filter(e=>!e.startsWith("!")).some(t=>(0,a.s7)(e,t,{dot:!0,matchBase:!0})),n=i.filter(e=>e.startsWith("!")).some(t=>(0,a.s7)(e,t.slice(1),{dot:!0,matchBase:!0}));return t&&!n};for(;c.length>0;){let[e,n]=c.shift();for await(let i of e.values()){if(o.length>=r)throw Error("Maximum number of files (".concat(r,") exceeded"));if(i.name.startsWith(".")&&".gitignore"!==i.name)continue;let e="".concat(n,"/").concat(i.name);if(!u(e.slice(t.length+1))){if("file"===i.kind){let e=await d(i,n);o.push(e)}else c.push([i,e])}}}return o}async function b(e){try{let t=await e.getFileHandle(".gitignore",{create:!1}),n=await t.getFile();return(await n.text()).split("\n").filter(e=>""!==e.trim()&&!e.startsWith("#"))}catch(e){return[]}}async function D(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500;try{let r=[...await b(e),...t],i=await T(e,e.name,r,n);return{handle:e,name:e.name,descendants:i}}catch(e){if(e instanceof Error&&e.message.includes("Maximum number of files"))throw Error("The size of this directory may cause performance degradation. Please choose a smaller directory.");throw e}}async function P(e){let t;let n=e.root;try{t=await D(e.root.handle,e.ignorePatterns)}catch(e){return null}let r=x(n.descendants),i=x(t.descendants),a=[];for(let[e,t]of r.entries()){let n=i.get(e);if(void 0===n){a.push({type:"removed",file:t});continue}n.lastModified!==t.lastModified&&a.push({type:"modified",file:n}),i.delete(e)}for(let e of i.values())a.push({type:"added",file:e});return{updatedDirectoryRoot:t,fileChanges:a}}function x(e){let t=new Map;for(let n of e)t.set(n.path,n);return t}let A=new Map,M=(e,t)=>{A.size>=1e3&&Array.from(A.keys()).slice(0,Math.floor(200)).forEach(e=>A.delete(e)),A.set(e,t)};function j(e){if(A.has(e))return A.get(e);if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');let t=new URL(e),n=t.host,[r,i,a,...o]=t.pathname.split("/").map(decodeURIComponent);if(!(n&&o.length))throw Error("Invalid URI: Missing required components");let c={projectUuid:n,directoryUuid:i,directoryName:a,pathComponents:o};return M(e,c),c}function R(e){try{return j(e),!0}catch(e){return!1}}function F(e){if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[r,i,a,...o]=t.pathname.split("/").map(decodeURIComponent);if(!n||!i||!a)throw Error("Invalid URI: Missing required components");return{projectUuid:n,directoryUuid:i,directoryName:a,pathComponents:o}}catch(e){throw Error("Invalid URI: ".concat(e.message))}}},80762:function(e,t,n){function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}n.d(t,{f:function(){return r},v:function(){return i}})}}]);